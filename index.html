<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <title>2025 大阪萬博新聞</title>
</head>

<body>
    <header>
        <div>
            <h1>EXPO 2025 OSAKA NEWS</h1>
        </div>
    </header>

    <main>
        <div>
            <div id="news-container">載入中...</div>
            <button id="load-more">載入更多</button>
        </div>
    </main>

    <script>
        const rssUrl = "https://news.google.com/rss/search?q=2025+大阪萬博&hl=zh-TW&gl=TW&ceid=TW:zh-Hant";
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`;

        let newsItems = [];  // 儲存所有新聞
        let currentIndex = 0; // 當前顯示到第幾條新聞
        const batchSize = 12; // 每次顯示 20 條新聞

        async function fetchGoogleNews() {
            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, "text/xml");

                newsItems = Array.from(xmlDoc.querySelectorAll("item")).map(item => {
                    let title = item.querySelector("title").textContent;
                    let source = item.querySelector("source") ? item.querySelector("source").textContent : "未知來源";

                    // **刪除標題末尾的媒體名稱**
                    title = title.replace(/\s*[-|]\s*[^-|\n]+$/, ""); // 移除最後的「- 媒體名」或「| 媒體名」

                    return {
                        title: title,
                        link: item.querySelector("link").textContent,
                        pubDate: new Date(item.querySelector("pubDate").textContent),
                        source: source
                    };
                });

                newsItems.sort((a, b) => b.pubDate - a.pubDate);
                currentIndex = 0;

                if (newsItems.length > 0) {
                    document.getElementById("news-container").innerHTML = "";
                    displayNextBatch();
                } else {
                    document.getElementById("news-container").innerHTML = "沒有找到相關新聞";
                }
            } catch (error) {
                console.error("獲取新聞失敗：", error);
                document.getElementById("news-container").innerHTML = "無法獲取新聞，請稍後再試。";
            }
        }


        function displayNextBatch() {
            const newsContainer = document.getElementById("news-container");

            for (let i = currentIndex; i < Math.min(currentIndex + batchSize, newsItems.length); i++) {
                const item = newsItems[i];

                const newsItem = document.createElement("div");
                newsItem.className = "news-item";
                newsItem.innerHTML = `
                    <div class="news-media">${item.source}</div>
                    <div class="news-title"><a href="${item.link}" target="_blank">${item.title}</a></div>
                    <div class="news-date">發布日期：${item.pubDate.toLocaleDateString("zh-TW")}</div>
                `;
                newsContainer.appendChild(newsItem);
            }

            currentIndex += batchSize;

            // 如果還有更多新聞，顯示「載入更多」按鈕
            const loadMoreButton = document.getElementById("load-more");
            if (currentIndex < newsItems.length) {
                loadMoreButton.style.display = "block";
            } else {
                loadMoreButton.style.display = "none";
            }
        }

        document.getElementById("load-more").addEventListener("click", displayNextBatch);

        fetchGoogleNews();
    </script>
</body>

</html>
